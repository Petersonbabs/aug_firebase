<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intro to Firebase</title>
</head>

<h1>Intro to firebase</h1>

<p>Hello <span id="user-email"></span></p>

<button id="signup-btn">Signup</button>
<button id="login-btn">login</button>
<button id="logout-btn">logout</button>


<body>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, setDoc, doc, collection } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";


        const firebaseConfig = {
            apiKey: "AIzaSyD37mI-m1x1kfRRmR4loaJsNx-zz5Hv_84",
            authDomain: "augecommerce-769b9.firebaseapp.com",
            projectId: "augecommerce-769b9",
            storageBucket: "augecommerce-769b9.firebasestorage.app",
            messagingSenderId: "319596472019",
            appId: "1:319596472019:web:911f4158917a957b841626"
        };

        const app = initializeApp(firebaseConfig)
        const auth = getAuth(app)
        const DB = getFirestore(app)
        const usersColRef = collection(DB, "users")

        // console.log(auth)
        // HTML ELEMENTS
        const signupBtnEl = document.getElementById("signup-btn")
        const loginBtnEl = document.getElementById("login-btn")
        const logoutBtnEl = document.getElementById("logout-btn")
        const userEmailEl = document.getElementById("user-email")

        // AUTHSTATE
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log(user)
                userEmailEl.textContent = user.email
            } else {
                // redirect login
                console.log("No user")
            }
        })

        // LOGOUT
        const logout = async () => {
            try {
                await signOut(auth)
            } catch (error) {
                console.log(error)
            } finally {
                console.log("DONE")
            }
        }



        // SIGNUP
        const signup = async () => {
            console.log("SIGNUP up...")
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, "jaliok@gmail.com", "Test1234")
                if (userCredential.user) {
                    sendEmailVerification(userCredential.user)
                    const newUser = {
                        name: "Jaliko",
                        email: "jaliok@gmail.com",
                        gender: "Male"
                    }
                    const userDocRef = doc(usersColRef, userCredential.user.uid)
                    await setDoc(userDocRef, newUser)
                }
            } catch (error) {
                console.log(error)
            } finally {
                console.log("DONE!")
            }
        }

        // LOGIN
        const login = async () => {
            console.log("authenticating...")
            try {
                const userCredential = await signInWithEmailAndPassword(auth, "hhh@gmail.com", "Test1234")
                if (userCredential.user) {
                    console.log(userCredential.user)
                }
            } catch (error) {
                console.log(error)
            } finally {
                console.log("DONE!")
            }
        }


        signupBtnEl.addEventListener("click", signup)
        loginBtnEl.addEventListener("click", login)
        logoutBtnEl.addEventListener("click", logout)





    </script>
</body>

</html>